jQuery(document).ready(function(e){function t(){_.create(),e(".game_over").fadeOut(),c=!1,u=!1,_.currentPositionperso={x:0,y:0},w.perso.finish().css({left:65,top:35})}function o(e){if("aveugle"==m)switch(e.keyCode){case 37:a.emit("mouvement",{direction:"left",current_room:p});break;case 38:a.emit("mouvement",{direction:"up",current_room:p});break;case 39:a.emit("mouvement",{direction:"right",current_room:p});break;case 40:a.emit("mouvement",{direction:"down",current_room:p})}}function r(){C.stop(),k.stop(),D.stop(),x.stop()}var n,s=0,a=io.connect("http://serck.ddns.net:1337"),c=!1,u=!1,p="",l=0,m="guide",d=0,h=0;console.log("game_over"+c),e("#login").submit(function(t){t.preventDefault();var o=e("#pseudo").val();""==o?e(".error_pseudo").fadeIn():a.emit("login",{username:o})}),a.on("change_pseudo",function(t){e(".error_pseudo").fadeIn()}),a.on("newuser",function(t){d++,1==d&&e("#users div ul").append('<li><a id="noUser">no useur for the moment</a></li>'),d>=2&&e("#users div ul #noUser").parent().remove(),e("#users div ul").append('<li > <a class="room" data-id="'+t.socket_id+'" href="#" id = "'+t.username+'">'+t.username+"</a></li>"),e(".room").click(function(t){t.preventDefault();var o=e(".current_user").text(),r=e(".current_user").attr("data-id"),i=e(this).attr("data-id");a.emit("invite",i,o,r),e(".user_invite_feedback").text(e(this).text()),e(".ask_join").slideDown(400)})}),a.on("invite_send",function(t){console.log("invite_client",t),e(".user_invite").html(t.username).attr("data-id",t.id),e(".join").slideDown(400)}),a.on("current_user",function(t){console.log(t,"me"),e(".current_user").text(t.username).attr("data-id",t.socket_id),e("#"+t.username).parent().remove()}),a.on("disuseur",function(t){s=0,e("#"+t.username).parent().remove(),d--,1==d&&e("#users div ul").append('<li><a id="noUser">no useur for the moment</a></li>'),2==d&&e("#users div ul #noUser").parent().remove()}),e(".unjoin_room").click(function(t){t.preventDefault(),e(".join").slideUp(400)}),e(".join_room").click(function(t){t.preventDefault();var o=e(".user_invite").attr("data-id");console.log(o,"id_coop"),a.emit("launch",{id_coop:o})}),a.on("launch_send",function(){a.emit("create")}),a.on("start",function(t){console.log(t,"in"),p=t,e("#users").fadeOut(),_.create()}),e(".start_game").click(function(e){w.displayRole(m),_.displayScore(s)}),a.on("disconenct_room",function(){e("<div class='restart_box center-e'><div><h2>Sorry</h2><p> your coop has left the game.</p><a class='restart' href=''>Try again</a></div></div>").appendTo("body").fadeIn()});var f=function(){};f.prototype.displayScore=function(t){e("#score_current").empty(),e("<h1> level : "+t+"</h1>").appendTo("#score_current").fadeIn(2e3).fadeOut(2e3)},f.prototype.value=[1,2,3],f.prototype.randomDecorMatrice=function(){var e=new Array(4);for(i=0;i<4;i++)for(e[i]=new Array(4),j=0;j<4;j++)e[i][j]=this.value[Math.floor(3*Math.random())];return e},f.prototype.randomWayMatrice=function(){for(var e=[],t=0;4>t;t++){e[t]=[];for(var o=0;4>o;o++)e[t][o]=0}for(var r=0,i=0,n=3,s=3;r!=n||i!=s;){var a=Math.floor(2*Math.random());0===a?n>r?(r++,e[r][i]=99):(i++,e[r][i]=99):s>i?(i++,e[r][i]=99):(r++,e[r][i]=99)}return e},f.prototype.Matrice_bomb="",f.prototype.bombMatrice=function(e){var t={x:0,y:0},o=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];if(1==s&&(o[0][2]=1),2==s)o[0][2]=0;else for(var r=e;r>0;r--)t.x=Math.floor(3*Math.random()),t.y=Math.floor(3*Math.random()),1==o[t.x][t.y]||3===t.y&&3===t.x||0===t.y&&0===t.x||1===t.y&&0===t.x||1===t.x&&0===t.y||1===t.y&&1===t.x?r++:o[t.x][t.y]=1;this.Matrice_bomb=o,this.getPositionBombDom(this.Matrice_bomb)},f.prototype.bombAction=function(){1===s&&(this.matrice=[[0,99,99,1],[99,99,99,1],[99,99,99,1],[1,1,99,0]],this.generate())},f.prototype.getPositionBombDom=function(){caseBomb=[];for(var e=0;e<this.Matrice_bomb.length;e++)for(var t=0;t<this.Matrice_bomb.length;t++)1===this.Matrice_bomb[e][t]&&caseBomb.push(4*e+t+1+3);this.bombDisplay(caseBomb)},f.prototype.bombDisplay=function(t){e(".part_map").removeClass("bombAction");for(var o=t.length-1;o>=0;o--)e(".part_map:nth-child("+t[o]+")").addClass("bombAction")},f.prototype.sumMatrice=function(){for(var e=this.randomWayMatrice(),t=this.randomDecorMatrice(),o=[],r=0;4>r;r++)o[r]=new Array(4);for(var i=0;i<o.length;i++)for(var n=0;n<o.length;n++)o[i][n]=e[i][n]+t[i][n];0===s&&(o=[[0,99,99,99],[99,99,99,99],[99,99,99,99],[99,99,99,0]]),1===s&&(o=[[0,99,99,1],[99,99,99,1],[99,99,99,1],[1,1,1,0]]),2===s&&(o=[[0,99,99,1],[1,1,99,99],[1,99,99,1],[1,1,99,0]]),3===s&&(o=[[99,1,2,1],[99,1,99,1],[99,99,99,99],[99,1,2,1]]),4===s&&(o=[[99,2,99,99],[3,3,3,2],[2,2,3,3],[99,2,3,99]]),5===s&&(o=[[99,1,99,99],[99,1,99,99],[99,99,1,99],[99,99,1,99]]),this.matrice=o},f.prototype.matrice="",f.prototype.currentPositionperso={x:0,y:0},f.prototype.positionPersoMatrice=function(e){switch(e){case"left":this.currentPositionperso.x--;break;case"right":this.currentPositionperso.x++;break;case"up":this.currentPositionperso.y--;break;case"down":this.currentPositionperso.y++}var t=this.matrice[this.currentPositionperso.y][this.currentPositionperso.x];this.Matrice_bomb[this.currentPositionperso.y][this.currentPositionperso.x];this.terrainAction(t)};var v=[];f.prototype.matriceTeleport=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],f.prototype.teleportInit=function(){switch(s){case 0:this.matriceTeleport=[[0,0,0,0],[0,0,1,0],[0,1,0,0],[0,0,0,0]];break;case 5:this.matriceTeleport=[[0,0,1,0],[0,0,0,0],[0,0,0,0],[0,1,0,0]];break;default:this.matriceTeleport=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}v=[];for(var e=0;e<this.matriceTeleport.length;e++)for(var t=0;t<this.matriceTeleport.length;t++)1===this.matriceTeleport[e][t]&&v.push(4*e+t+1+3);this.teleportDisplay()},f.prototype.teleportDisplay=function(){e(".part_map").removeClass("teleportAction");for(var t=v.length-1;t>=0;t--)e(".part_map:nth-child("+v[t]+")").addClass("teleportAction")},f.prototype.teleportActif=function(e){switch(e){case"left":1===this.matriceTeleport[this.currentPositionperso.y][this.currentPositionperso.x-1]&&(this.currentPositionperso.x=this.currentPositionperso.x-1,this.teleportActionVerification());break;case"right":1===this.matriceTeleport[this.currentPositionperso.y][this.currentPositionperso.x+1]&&(this.currentPositionperso.x=this.currentPositionperso.x+1,this.teleportActionVerification());break;case"up":1===this.matriceTeleport[this.currentPositionperso.y-1][this.currentPositionperso.x]&&(this.currentPositionperso.y=this.currentPositionperso.y-1,this.teleportActionVerification());break;case"down":1===this.matriceTeleport[this.currentPositionperso.y+1][this.currentPositionperso.x]&&(this.currentPositionperso.y=this.currentPositionperso.y+1,this.teleportActionVerification(e))}};var y={x:0,y:0};f.prototype.teleportActionVerification=function(e){for(var t=0;t<this.matriceTeleport.length;t++)for(var o=0;o<this.matriceTeleport.length;o++)1==this.matriceTeleport[t][o]&&t!==this.currentPositionperso.y&&o!==this.currentPositionperso.x&&(y={x:o,y:t});w.perso.finish().css({left:100*y.x+65,top:100*y.y+35}),_.currentPositionperso={x:y.x,y:y.y}};var b=[];f.prototype.matriceDoubleDirection=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],f.prototype.addDoubleAction=function(){e(".part_map").removeClass("doubleAction");for(var t=b.length-1;t>=0;t--)e(".part_map:nth-child("+b[t]+")").addClass("doubleAction")},f.prototype.doubleDirectionChange=function(){switch(s){case 0:this.matriceDoubleDirection=[[0,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]];break;case 3:this.matriceDoubleDirection=[[0,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]];break;default:this.matriceDoubleDirection=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}b=[];for(var e=0;e<this.matriceDoubleDirection.length;e++)for(var t=0;t<this.matriceDoubleDirection.length;t++)1===this.matriceDoubleDirection[e][t]&&b.push(4*e+t+1+3);this.addDoubleAction()},f.prototype.doubleActionActif=function(e){if(1===this.matriceDoubleDirection[this.currentPositionperso.y][this.currentPositionperso.x])switch(e){case"left":this.currentPositionperso.x-2<=3&&this.currentPositionperso.x>=0&&(w[e](),_.positionPersoMatrice(e),w.displayCurrentPosition());break;case"right":this.currentPositionperso.x+2<=3&&this.currentPositionperso.x>=0&&(w[e](),_.positionPersoMatrice(e),w.displayCurrentPosition());break;case"up":this.currentPositionperso.y-2<=3&&this.currentPositionperso.y>=0&&(w[e](),_.positionPersoMatrice(e),w.displayCurrentPosition());break;case"down":this.currentPositionperso.y+2<=3&&this.currentPositionperso.y>=0&&(w[e](),_.positionPersoMatrice(e),w.displayCurrentPosition())}};var g=!1;f.prototype.terrainActionGlaceActif=function(){g===!0&&(this.matrice[this.currentPositionperso.y][this.currentPositionperso.x]=2,this.generate(),g=!1)},f.prototype.terrainAction=function(e){switch(!0){case 1==e:break;case 2==e:a.emit("game_over",p);break;case 3==e:g=!0;break;case e>=99&&1e3>e:break;case 1e3==e:}},f.prototype.generate=function(){e(".part_map").remove(),this.matrice[3][3]=1e3,this.matrice[0][0]=1e3,e.each(this.matrice,function(t,o){e.each(o,function(t,o){switch(!0){case 1==o:o="buisson";break;case 2==o:o="water";break;case 3==o:o="glace";break;case o>=99&&1e3>o:o="terre";break;case 1e3==o:o="start"}"buisson"==o?e('<div class="part_map"><span class="front"></span><span class="up"></span><span class="side"></span></div>').addClass(o).appendTo(".all_map"):e('<div class="part_map" />').addClass(o).appendTo(".all_map")})}),e(".part_map:nth-child(4)").addClass("active"),this.doubleDirectionChange(),this.teleportInit(),this.bombMatrice(0)},f.prototype.create=function(){"guide"===m&&(this.sumMatrice(),a.emit("share_map",{map:this.matrice,current_room:p}),this.generate()),w.displayRole(m),_.displayScore(s)},f.prototype.sucess_level=function(){3==_.currentPositionperso.y&&3==_.currentPositionperso.x&&(setTimeout(function(){n=h,h=0,a.emit("success",p)},2e3),u=!0)};var _=new f;a.on("send_map",function(t){_.matrice=t,_.generate(),_.bombMatrice(0),e(".all_map").addClass("aveugle"),_.doubleDirectionChange()}),a.on("logged",function(){e(".section_login").fadeOut()});var P=function(){};P.prototype.displayRole=function(t){e("#role_guide").removeClass("active"),e("#role_aveugle").removeClass("active"),"guide"==t?e("#role_guide").addClass("active"):e("#role_aveugle").addClass("active")},P.prototype.perso=e(".perso"),P.prototype.verficationPosition=function(e){return"left"==e&&_.currentPositionperso.x>0?1==_.matrice[_.currentPositionperso.y][_.currentPositionperso.x-1]?!1:(1==_.Matrice_bomb[_.currentPositionperso.y][_.currentPositionperso.x-1]&&_.bombAction(),!0):"right"==e&&_.currentPositionperso.x<3?1==_.matrice[_.currentPositionperso.y][_.currentPositionperso.x+1]?!1:(1==_.Matrice_bomb[_.currentPositionperso.y][_.currentPositionperso.x+1]&&_.bombAction(),!0):"up"==e&&_.currentPositionperso.y>0?1==_.matrice[_.currentPositionperso.y-1][_.currentPositionperso.x]?!1:(1==_.Matrice_bomb[_.currentPositionperso.y-1][_.currentPositionperso.x]&&_.bombAction(),!0):"down"==e&&_.currentPositionperso.y<3?1==_.matrice[_.currentPositionperso.y+1][_.currentPositionperso.x]?!1:(1==_.Matrice_bomb[_.currentPositionperso.y+1][_.currentPositionperso.x]&&_.bombAction(),!0):(3==_.currentPositionperso.y&&3==_.currentPositionperso.x,!1)},P.prototype.displayCurrentPosition=function(){if("aveugle"==m){var t=4*_.currentPositionperso.y+_.currentPositionperso.x+1;e(".all_map>.part_map").removeClass("active"),e(".all_map>.part_map:nth-child("+(t+3)+")").addClass("active")}},P.prototype.compteur=function(){h++},P.prototype.left=function(){this.perso.finish().animate({left:"-=100px"},"slow")},P.prototype.right=function(){this.perso.finish().animate({left:"+=100px"},"slow")},P.prototype.up=function(){this.perso.finish().animate({top:"-=100px"},"slow")},P.prototype.down=function(){this.perso.finish().animate({top:"+=100px"},"slow")};var w=new P;a.on("aveugle",function(){m="aveugle"}),window.addEventListener("keydown",o,!1),e("body").hammer().data("hammer").get("swipe").set({direction:Hammer.DIRECTION_ALL}),e("body").hammer().on("swipeleft",function(e){a.emit("mouvement",{direction:"left"})}),e("body").hammer().on("swiperight",function(e){a.emit("mouvement",{direction:"right"})}),e("body").hammer().on("swipeup",function(e){a.emit("mouvement",{direction:"up"})}),e("body").hammer().on("swipedown",function(e){a.emit("mouvement",{direction:"down"})}),a.on("recive",function(e){w.verficationPosition(e)===!0&&0==u&&c===!1&&(_.terrainActionGlaceActif(),_.doubleActionActif(e),_.teleportActif(e),w[e](),w.compteur(),_.positionPersoMatrice(e),w.displayCurrentPosition(),_.sucess_level())});var x=new Howl({urls:["sound/left.mp3","sound/left.ogg"],sprite:{0:[1700,800],1:[2500,1e3],2:[3500,1e3]}}),k=new Howl({urls:["sound/right.mp3","sound/right.ogg"],sprite:{0:[3e3,1e3],1:[4200,1500],2:[5700,1e3]}}),D=new Howl({urls:["sound/up.mp3","sound/up.ogg"],sprite:{0:[1700,1780],1:[3480,1e3],2:[4480,1050]}}),C=new Howl({urls:["sound/down.mp3","sound/down.ogg"],sprite:{0:[1700,1e3],1:[2780,1100],2:[4e3,1300]}});if(e(".sound_left").click(function(e){e.preventDefault(),a.emit("sound",{direction:"left",current_room:p})}),e(".sound_right").click(function(e){e.preventDefault(),a.emit("sound",{direction:"right",current_room:p})}),e(".sound_up").click(function(e){e.preventDefault(),a.emit("sound",{direction:"up",current_room:p})}),e(".sound_down").click(function(e){e.preventDefault(),a.emit("sound",{direction:"down",current_room:p})}),a.on("sound_send",function(e){r();var t=Math.floor(3*Math.random());switch(e){case"right":k.play(t);break;case"left":x.play(t);break;case"up":D.play(t);break;case"down":C.play(t)}}),annyang){var M={"go *direction":function(t){console.log("go "+t),"left"==t||"up"==t||"right"==t||"down"==t?e(".sound_"+t).trigger("click"):console.log("wrong direction sound "+t)}};annyang.addCommands(M),annyang.start()}a.on("game_over_send",function(){l++,e("<div class='game_over_box center-e'><div><h1>Game Over</h1><p> meuilleur score : "+s+"</p><a class='try_again' href=''>Try again</a><form action='' method='POST'><legend>Save score</legend><label for='teamName'>select a team Name</label><input name='teamName' type='text' value='anonymous Team'><input name='score' type='hidden' value="+s+"><input class='submit_score' type='submit' value='submit score'></form></div></div>").appendTo("body").fadeIn(),c=!0,2==l&&(s=0,l=0),e(".try_again").click(function(e){e.preventDefault(),console.log(p,"current_room"),a.emit("reset",p)})}),a.on("reset_send",function(){e(".game_over_box").fadeOut(),t()}),a.on("success_send",function(){l++,2==l&&(s++,"aveugle"==m?(m="guide",e(".all_map").removeClass("aveugle")):m="aveugle",t(),l=0,console.log(l,"all_success"))}),e(".toggle_help_button").click(function(t){t.preventDefault(),e(".toggle_help").toggleClass("toggle_help_actif")}),e(".menu a").click(function(t){t.preventDefault(),console.log(this.innerHTML),e("#about").removeClass("active"),e("#scores").removeClass("active"),e("#instructions").removeClass("active"),e("#login").removeClass("active"),e("#"+this.innerHTML).addClass("active")});var A=function(e,t,o,r){var i=o||640,n=r||320,s=window.screenLeft||window.screenX,a=window.screenTop||window.screenY,c=window.innerWidth||document.documentElement.clientWidth,u=window.innerHeight||document.documentElement.clientHeight,p=s+c/2-i/2,l=a+u/2-n/2,m=window.open(e,t,"scrollbars=yes, width="+i+", height="+n+", top="+l+", left="+p);return m.focus(),!0};document.querySelector(".share_twitter").addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("data-url"),o="https://twitter.com/intent/tweet?text="+encodeURIComponent(document.title)+"&via=Serck_Timothee&url="+encodeURIComponent(t);A(o,"Partager sur Twitter")}),document.querySelector(".share_facebook").addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("data-url"),o="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t);A(o,"Partager sur facebook")}),e(".ascenseur").next("div").hide(),e(".ascenseur").click(function(){e(this).next("div").is(":hidden")&&(e(".ascenseur").next("div:visible").slideUp(),e(this).next("div").slideDown())})});